asyncapi: 3.0.0
info:
    title: User Signup API
    version: 1.0.0
    description: The API notifies you whenever a new user signs up in the application.
    tags:
        - name: Anomalies
          description: Events about anomalies detected in the system
        - name: Measurements
          description: Events about measurements detected in the system
        - name: Detections
          description: Events about object recognized in the system
        - name: Users
          description: Events about users operations in the system

servers:
    firstKafkaServer:
        host: kafka-broker-1:8092
        description: First instance of Kafka
        protocol: kafka
    secondKafkaServer:
        host: kafka-broker-2:8092
        description: Second instance of Kafka
        protocol: kafka

operations:
    publishAnomalyDetected:
        action: send
        summary: Publish a message to the AnomalyDetected channel
        channel:
            $ref: "#/channels/anomalies"
    onAnomalyDetected:
        action: receive
        summary: Receive a message from the AnomalyDetected channel
        channel:
            $ref: "#/channels/anomalies"

    publishMeasurementDetected:
        action: send
        summary: Publish a message to the MeasurementDetected channel
        channel:
            $ref: "#/channels/measurements.{sensorId}"
    onMeasurementDetected:
        action: receive
        summary: Receive a message from the MeasurementDetected channel
        channel:
            $ref: "#/channels/measurements.{sensorId}"

    publishDetectionDetected:
        action: send
        summary: Publish a message to the DetectionDetected channel
        channel:
            $ref: "#/channels/detection.{cameraId}"
    onDetectionDetected:
        action: receive
        summary: Receive a message from the DetectionDetected channel
        channel:
            $ref: "#/channels/detection.{cameraId}"

channels:
    anomalies:
        tags:
            - name: Anomalies
        description: This channel contains a message per each anomaly detected in the system.
        address: anomalies
        messages:
            Anomaly:
                $ref: "#/components/messages/Anomaly"
    measurements.{sensorId}:
        tags:
            - name: Measurements
        description: This channel contains a message per each measurement detected in the system for a specific device.
        address: measurements.{sensorId}
        messages:
            Measurement:
                $ref: "#/components/messages/Measurement"
    detection.{cameraId}:
        tags:
            - name: Detections
        description: This channel contains a message per each detection detected in the system for a specific device.
        address: detection.{cameraId}
        messages:
            Detection:
                $ref: "#/components/messages/Detection"

components:
    messages:
        Anomaly:
            payload:
                $ref: "#/components/schemas/Anomaly"

        Measurement:
            payload:
                $ref: "#/components/schemas/Measurement"

        Detection:
            payload:
                $ref: "#/components/schemas/Detection"

    schemas:
        DeviceId:
            additionalProperties: false
            type: object
            properties:
                code:
                    type: string
                    description: The unique code of the device

        AnomalyId:
            additionalProperties: false
            type: object
            properties:
                code:
                    type: string
                    description: The unique code of the anomaly

        MeasurementId:
            additionalProperties: false
            type: object
            properties:
                code:
                    type: string
                    description: The unique code of the measurement

        DetectionId:
            additionalProperties: false
            type: object
            properties:
                code:
                    type: string
                    description: The unique code of the detection

        Anomaly:
            additionalProperties: false
            type: object
            properties:
                anomalyId:
                    $ref: "#/components/schemas/AnomalyId"
                timestamp:
                    type: string
                    format: date-time
                data:
                    type: object

        MeasureType:
            additionalProperties: false
            type: object
            properties:
                type:
                    type: string
                    description: The type of the measure (Temperature, Humidity, etc.)
                unit:
                    type: string
                    description: The unit of the measure (Celsius, Fahrenheit, etc.)

        Measurement:
            additionalProperties: false
            type: object
            properties:
                measurementId:
                    $ref: "#/components/schemas/MeasurementId"
                sourceDeviceId:
                    additionalProperties: false
                    type: object
                    properties:
                        code:
                            type: string
                            description: The unique code of the device that generated the measurement
                timestamp:
                    type: string
                    format: date-time
                    description: The timestamp when the measurement was created
                value:
                    additionalProperties: false
                    type: object
                    description: The value of the measurement (Numerical, String, etc.)

        Detection:
            additionalProperties: false
            type: object
            properties:
                detectionId:
                    $ref: "#/components/schemas/DetectionId"
                sourceDeviceId:
                    $ref: "#/components/schemas/DeviceId"
                timestamp:
                    type: string
                    format: date-time
                    description: The timestamp when the detection was created
                objectClass:
                    type: string
                    description: The class of the object detected (Person, Car, Dog, etc.)
